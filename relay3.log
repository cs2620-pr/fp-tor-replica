[Relay] ---- Relay process started ----
[Relay 3] [Relay] Loaded persistent RSA keypair from relay3_key.pem
[Relay 3] [Relay] Public key fingerprint: 7a46893f440bcfb43ce49eb8d8156323dab3b8a3de869d2faebb649692ef6c1c
[Relay 3] [Relay] [KEY] Public key fingerprint: 7a46893f440bcfb43ce49eb8d8156323dab3b8a3de869d2faebb649692ef6c1c
[Relay 3] Relay 3 starting on 10.250.120.196:9103 (RELAY PORT 9103)
[Relay 3] Registering with CDS at 127.0.0.1:9000
[Relay 3] [Relay] Registered with CDS: {'ip': '10.250.120.196', 'port': 9103, 'public_key': '-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5k9OJ8m3IdjmwR1skM1G\nwrKkwlYLK0Qs+I/BX5ww5wEakOsTy5NVFAwTYrCUnR012u2jCwI8wV1YpPaMa8RJ\ntnqNFy4pFfqBh5tmidHQ3QMRvINPrGtQM5+VgMXoA0y8izql52M1K/3Q6sHVlAXd\nmpQcBO+JSHY7uyVx1txZssyisia7Nn8Frh/XRpl0oUvGkSnbm/KgqDAP0xJ3lUZS\nEGiIWdf0bn7tHD3nYBMrWWi3jSQWf0Q80asIEYWipwkfMPf0ffzu4FX0elfvpyOX\nr50xk7sb8K5IhcilwxKxQpPOcq3f6ph0EERQR7pOdDqkzFdHoGiyssSX4MYM60kd\nmQIDAQAB\n-----END PUBLIC KEY-----\n'}
[Relay 3] [Relay] Listening for incoming messages on port 9103 (RELAY PORT 9103)
[Relay 3] [Relay] [handle_message ENTERED] addr=('10.250.120.196', 60529), thread=6156529664, relay_port=9103
[Relay 3] [Relay] [DEBUG] Raw data received: b'{"next_ip": "10.250.120.196", "next_port": 9103, "session_key": "XFTic0/n0Y6aLSXl5LZO92eNSW+EjlwsDIYsaWr+2s/NVMM7fuXLndpetTzxFepobApIC/LEA40KBuNsL+JHoO1S8uF1h7qAVntAInGkbQPhGVItkjIscpVYiZ+8c+khEBGAcNjL0aUkGtT/ftTHkssOTthXKRi2h8MkfWKJskt2Wos2JKndPN3L42KxiKbNjJHG8KcgMeboUsD41Eby4ziMN8pzt287EfOY+L/hY5+tc1f5sDpfmwlxfnSHBhf/eqsuLjl1XxUiihQg9AcS2+aMqnnxK2rWTx382+WVPsSzLBI+FyjOUhj3BRlWPfSdRILdhT8gahxa7JeVLneS4Q==", "payload": "0PzJ9CmkDE1T5H7QpVppgS+mKPXVI+2K2wG5GddUYvn1Q1pyW0XqGQ=="}'
[Relay 3] [Relay] [DEBUG] Data after JSON parse: type=<class 'dict'>, keys=['next_ip', 'next_port', 'session_key', 'payload']
[Relay 3] [Relay] Received session_key (base64): XFTic0/n0Y6aLSXl5LZO92eNSW+EjlwsDIYsaWr+2s/NVMM7fuXLndpetTzxFepobApIC/LEA40KBuNsL+JHoO1S8uF1h7qAVntAInGkbQPhGVItkjIscpVYiZ+8c+khEBGAcNjL0aUkGtT/ftTHkssOTthXKRi2h8MkfWKJskt2Wos2JKndPN3L42KxiKbNjJHG8KcgMeboUsD41Eby4ziMN8pzt287EfOY+L/hY5+tc1f5sDpfmwlxfnSHBhf/eqsuLjl1XxUiihQg9AcS2+aMqnnxK2rWTx382+WVPsSzLBI+FyjOUhj3BRlWPfSdRILdhT8gahxa7JeVLneS4Q==
[Relay 3] [Relay] Decoded session_key_enc (hex): 5c54e2734fe7d18e9a2d25e5e4b64ef7678d496f848e5c2c0c862c696afedacfcd54c33b7ee5cb9dda5eb53cf115ea686c0a480bf2c4038d0a06e36c2fe247a0ed52f2e17587ba80567b402271a46d03e119522d92322c729558899fbc73e92110118070d8cbd1a5241ad4ff7ed4c792cb0e4ed8572918b687c3247d6289b24b765a8b3624a9dd3cddcbe362b188a6cd8c91c6f0a72031e6e852c0f8d446f2e3388c37ca73b76f3b11f398f8bfe1639fad7357f9b03a5f9b09717e74870617ff7aab2e2e39755f15228a1420f40712dbe68caa79f12b6ad64f1dfcdbe5953ec4b32c123e1728ce5218f70519563df49d4482dd853f206a1c5aec97952e7792e1
[Relay 3] [Relay] Decrypting session key with fingerprint: 7a46893f440bcfb43ce49eb8d8156323dab3b8a3de869d2faebb649692ef6c1c
[Relay 3] [Relay] Decrypted session_key (hex): 959d6672cb586aa26cdc6b2bd3eafbc2e7fab13b3211495d9988b555e6189774
[Relay 3] [Relay] [DEBUG] About to AES-decrypt payload (passing base64 string directly)
[Relay 3] [Relay] [DEBUG] Payload base64-decoded: type=<class 'bytes'>, len=40, preview=b'\xd0\xfc\xc9\xf4)\xa4\x0cMS\xe4~\xd0\xa5Zi\x81/\xa6(\xf5\xd5#\xed\x8a\xdb\x01\xb9\x19\xd7Tb\xf9\xf5CZr[E\xea\x19'
[Relay 3] [Relay] [DEBUG] AES-decrypted payload: type=<class 'bytes'>, len=24, preview=b'{"msg": "Hello, world!"}'
[Relay 3] [Relay] [DEBUG] AES-decrypted payload (hex): 7b226d7367223a202248656c6c6f2c20776f726c6421227d
[Relay 3] [Relay] [DEBUG] Next hop JSON keys: ['msg']
[Relay 3] [Relay] [DEBUG] Payload is not JSON, assuming last hop. Error: 'next_ip'
[Relay 3] [Relay] [Last Hop] Forwarding payload to dest 127.0.0.1:9100, len=24, type=<class 'bytes'>
[Relay 3] [Relay] [Last Hop] Sending to dest: type=<class 'bytes'>, len=24, preview=b'{"msg": "Hello, world!"}'
[Relay 3] [Relay] [Last Hop] Received response from dest: type=<class 'bytes'>, len=50, preview=b'{"result": "OK", "echo": {"msg": "Hello, world!"}}'
[Relay 3] [Relay] [Last Hop] Response from dest decoded as UTF-8: '{"result": "OK", "echo": {"msg": "Hello, world!"}}'
[Relay 3] [Relay] [Last Hop] Response from dest (hex): 7b22726573756c74223a20224f4b222c20226563686f223a207b226d7367223a202248656c6c6f2c20776f726c6421227d7d
[Relay 3] [Relay] [Last Hop] About to AES-encrypt response: type=<class 'bytes'>, len=50, preview=b'{"result": "OK", "echo": {"msg": "Hello, world!"}}'
[Relay 3] [Relay] [Last Hop] AES-encrypted response (hex): 976f4e4c1b17e7703367ef8fdf921bebceaa01ed10cb414838d578e2c9be30cd5dede5441a342be49830c2b60d4bca0bae518b83bb2684740e36a093
[Relay 3] [Relay] [Last Hop] Base64-encoded AES-encrypted response: type=<class 'bytes'>, len=88, preview=b'l29OTBsX53AzZ++P35Ib686qAe0Qy0FIONV44sm+MM1d7eVEGjQr5JgwwrYN'
[Relay 3] [Relay] [Last Hop] Sent response to ('10.250.120.196', 60529): b'l29OTBsX53AzZ++P35Ib686qAe0Qy0FIONV44sm+MM1d7eVEGjQr5JgwwrYN'... (len=88)
[Relay 3] [Relay] [handle_message END] addr=('10.250.120.196', 60529), thread=6156529664
