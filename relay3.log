[Relay] ---- Relay process started ----
[Relay 3] [Relay] Loaded persistent RSA keypair from relay3_key.pem
[Relay 3] [Relay] Public key fingerprint: 7a46893f440bcfb43ce49eb8d8156323dab3b8a3de869d2faebb649692ef6c1c
[Relay 3] [Relay] [KEY] Public key fingerprint: 7a46893f440bcfb43ce49eb8d8156323dab3b8a3de869d2faebb649692ef6c1c
[Relay 3] Relay 3 starting on 10.250.153.213:9103 (RELAY PORT 9103)
[Relay 3] Registering with CDS at 127.0.0.1:9000
[Relay 3] [Relay] Registered with CDS: {'ip': '10.250.153.213', 'port': 9103, 'public_key': '-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5k9OJ8m3IdjmwR1skM1G\nwrKkwlYLK0Qs+I/BX5ww5wEakOsTy5NVFAwTYrCUnR012u2jCwI8wV1YpPaMa8RJ\ntnqNFy4pFfqBh5tmidHQ3QMRvINPrGtQM5+VgMXoA0y8izql52M1K/3Q6sHVlAXd\nmpQcBO+JSHY7uyVx1txZssyisia7Nn8Frh/XRpl0oUvGkSnbm/KgqDAP0xJ3lUZS\nEGiIWdf0bn7tHD3nYBMrWWi3jSQWf0Q80asIEYWipwkfMPf0ffzu4FX0elfvpyOX\nr50xk7sb8K5IhcilwxKxQpPOcq3f6ph0EERQR7pOdDqkzFdHoGiyssSX4MYM60kd\nmQIDAQAB\n-----END PUBLIC KEY-----\n'}
[Relay 3] [Relay] Listening for incoming messages on port 9103 (RELAY PORT 9103)
[Relay 3] [Relay] [handle_message ENTERED] addr=('10.250.153.213', 56626), thread=6200455168, relay_port=9103
[Relay 3] [Relay] [DEBUG] Raw data received: b'{"next_ip": "10.250.153.213", "next_port": 9103, "session_key": "tdJyrdZfqEJOmdF1SMBBilERFBIUEpVlzAlZFokk8/ml4wnksQEXuZvEOTVB7fmVM49HvtWCDKdiNTwrea9SlRT4sxPf1F6wdKc9FWHicYhIS1Tr+kdywIKpkdN8H68IdB1bQha8UKJ1vYmwurkPJGelGYdUFdtcC2pInT+k/yaah0z4/ZkUOLCO2tHe0XJwJYZfiup3guepLL3IXvXgoteJHeAg07tq2hUVOYGcfjZDOpzMfl5EhOyXV53RfIlhKS1GnI3hw5Vty7/8wNxPqNlVScJYmxtobEeCg8Bjra65tDtAMjp01WHmv+OZ3aSBV515oIP4473InKA3oNvuXg==", "payload": "vjEYbpj1Y0Zj0nadlCr3eUeFOmss7SiEqEROLnZM1f0BD/C9CcaElg=="}'
[Relay 3] [Relay] [DEBUG] Data after JSON parse: type=<class 'dict'>, keys=['next_ip', 'next_port', 'session_key', 'payload']
[Relay 3] [Relay] Received session_key (base64): tdJyrdZfqEJOmdF1SMBBilERFBIUEpVlzAlZFokk8/ml4wnksQEXuZvEOTVB7fmVM49HvtWCDKdiNTwrea9SlRT4sxPf1F6wdKc9FWHicYhIS1Tr+kdywIKpkdN8H68IdB1bQha8UKJ1vYmwurkPJGelGYdUFdtcC2pInT+k/yaah0z4/ZkUOLCO2tHe0XJwJYZfiup3guepLL3IXvXgoteJHeAg07tq2hUVOYGcfjZDOpzMfl5EhOyXV53RfIlhKS1GnI3hw5Vty7/8wNxPqNlVScJYmxtobEeCg8Bjra65tDtAMjp01WHmv+OZ3aSBV515oIP4473InKA3oNvuXg==
[Relay 3] [Relay] Decoded session_key_enc (hex): b5d272add65fa8424e99d17548c0418a5111141214129565cc0959168924f3f9a5e309e4b10117b99bc4393541edf995338f47bed5820ca762353c2b79af529514f8b313dfd45eb074a73d1561e27188484b54ebfa4772c082a991d37c1faf08741d5b4216bc50a275bd89b0bab90f2467a519875415db5c0b6a489d3fa4ff269a874cf8fd991438b08edad1ded1727025865f8aea7782e7a92cbdc85ef5e0a2d7891de020d3bb6ada151539819c7e36433a9ccc7e5e4484ec97579dd17c8961292d469c8de1c3956dcbbffcc0dc4fa8d95549c2589b1b686c478283c063adaeb9b43b40323a74d561e6bfe399dda481579d79a083f8e3bdc89ca037a0dbee5e
[Relay 3] [Relay] Decrypting session key with fingerprint: 7a46893f440bcfb43ce49eb8d8156323dab3b8a3de869d2faebb649692ef6c1c
[Relay 3] [Relay] Decrypted session_key (hex): ed3f30e6db0181e672d067010c9072a0deadd847b7fd89810ec3bb81647bb7b7
[Relay 3] [Relay] [DEBUG] About to AES-decrypt payload (passing base64 string directly)
[Relay 3] [Relay] [DEBUG] Payload base64-decoded: type=<class 'bytes'>, len=40, preview=b'\xbe1\x18n\x98\xf5cFc\xd2v\x9d\x94*\xf7yG\x85:k,\xed(\x84\xa8DN.vL\xd5\xfd\x01\x0f\xf0\xbd\t\xc6\x84\x96'
[Relay 3] [Relay] [DEBUG] AES-decrypted payload: type=<class 'bytes'>, len=24, preview=b'{"msg": "Hello, world!"}'
[Relay 3] [Relay] [DEBUG] AES-decrypted payload (hex): 7b226d7367223a202248656c6c6f2c20776f726c6421227d
[Relay 3] [Relay] [DEBUG] Next hop JSON keys: ['msg']
[Relay 3] [Relay] [DEBUG] Payload is not JSON, assuming last hop. Error: 'next_ip'
[Relay 3] [Relay] [Last Hop] Forwarding payload to dest 127.0.0.1:9100, len=24, type=<class 'bytes'>
[Relay 3] [Relay] [Last Hop] Sending to dest: type=<class 'bytes'>, len=24, preview=b'{"msg": "Hello, world!"}'
[Relay 3] [Relay] [Last Hop] Received response from dest: type=<class 'bytes'>, len=0, preview=b''
[Relay 3] [Relay] [Last Hop] Response from dest decoded as UTF-8: ''
[Relay 3] [Relay] [Last Hop] Response from dest (hex): 
[Relay 3] [Relay] [Last Hop] About to AES-encrypt response: type=<class 'bytes'>, len=0, preview=b''
[Relay 3] [Relay] [Last Hop] AES-encrypted response (hex): 50ccfbb7dc41799ae0be71337a7018cf
[Relay 3] [Relay] [Last Hop] Base64-encoded AES-encrypted response: type=<class 'bytes'>, len=24, preview=b'UMz7t9xBeZrgvnEzenAYzw=='
[Relay 3] [Relay] [Last Hop] Sent response to ('10.250.153.213', 56626): b'UMz7t9xBeZrgvnEzenAYzw=='... (len=24)
[Relay 3] [Relay] [handle_message END] addr=('10.250.153.213', 56626), thread=6200455168
