[Relay] ---- Relay process started ----
[Relay 1] [Relay] Loaded persistent RSA keypair from relay1_key.pem
[Relay 1] [Relay] Public key fingerprint: 74019246e4745ea09badde25326501d85571359b8b49ebb8349bb13a86da1d92
[Relay 1] [Relay] [KEY] Public key fingerprint: 74019246e4745ea09badde25326501d85571359b8b49ebb8349bb13a86da1d92
[Relay 1] Relay 1 starting on 10.250.120.196:9101 (RELAY PORT 9101)
[Relay 1] Registering with CDS at 127.0.0.1:9000
[Relay 1] [Relay] Registered with CDS: {'ip': '10.250.120.196', 'port': 9101, 'public_key': '-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5MM7/HBECV26fZqjUJkt\nQ4+dx297cL0hf1+rf08Qir5tL/lArfQsiplTqcsIsZiN7vJ8K2XzvK5JAEv8tVE4\nEKU4W1hbEVBd1eLCX+Oc5XauTbWhW8xlc2wdNlNwDhin2Mw84doKJWPyfjtIwnIi\n3nWHqxLyAqkj6qDoByA8D7YVmJxvzwL0mrYE8G8b4Q4Wjnx2SXeTwc9LRzqwrsyb\nlM5B4BSVPBignOMhD2AfuIFw6uULQThbkL9L5AnQA08B4Gqzo731LLJN/Y6qo+VJ\nki2t6m1aJTG0LBjijpH7CtnN1MHIQ5UueS1sJVYZooYxkxEYYZTqIUXxuI5ICKPC\nCQIDAQAB\n-----END PUBLIC KEY-----\n'}
[Relay 1] [Relay] Listening for incoming messages on port 9101 (RELAY PORT 9101)
[Relay 1] [Relay] [handle_message ENTERED] addr=('10.250.120.196', 61616), thread=6162165760, relay_port=9101
[Relay 1] [Relay] [DEBUG] Raw data received: b'{"session_key": "LLAVWpEcdNL9YiV91Sbn8rTPDESA+MazTvwxDo/g08225pLPF6OeFZX0JTv7P8eEWaHRrnrNfVHAo+OQW3S6LSy/lSctL3R1S8xclcMJdJ+vN0hwMgL29oiUlNZCdvP9zIhhGHLPAUXCPZq1Mh/Z8Sf7id2QrE3MshVHkbC0nrRNij8r1R/JOLmO9CqXPxWTRzyDP+tlR/AkEKSbeuwnHEUdKS+nIvjbZwsjaJOGbNQEce1TT5QDUIZ1w9ehgDzOoBEVM6Mc0IawzC/FCClERBA8L7WeoMjLTtm8QIEAgo1wi7G4rDUS/yFNGq+XrP3lnam3mcfFCim8huFH7N0plA==", "payload": "38FolrG50NdX4Ye35b74SWqkmTcywW/4S2G7Ls3BTI9uI6AaJnNdZpKkRw3QNX4WdqQTNdu2Ot/ciFQtNMf62NXn+VXz6otk6j3+wboBparPBJOVtRqfLZQDqGitHuxYpuFr0P2s7bT1ynRzVwfc1749UhClFtSuaeqt0SJo7l6+BxMigTmcPEKVKneo4XKEz0ugM97eSgTf3hQHa7PHQ3mJqRZJ6ZlDX64qjot+xuIjcvS51K5sVjgfB8J6BH26S8SrwHVBfH8yvkeu9/s0/8dtlMivW+IU1UnuGRn3471ZzStPdoJeE+gsDwSuyttS1i0lbJZaRtXDpwlkF8V2f+JsZFOLqTQrJEhh/VONDA66aQKwVpK5A0cUHjt0FVJyi1mvBkJp2kl+xGjU88+VTU/YChTyQxk2AC031ndYol3KPYICjayY1G+F0mdaomq5jKrAc9zUuePuw+5jdX9lGgQ6IkOcqwpfY55XIb9ELTcFchjA+4dyWmtRv6ILy8iTYQ85A0WwPuEUkOKABlziqaUNfrVNyL6HQHAKU6rtPR2dkcp7APN2Ks0eO+zh8KGw+StHtdg+xrbUkOqN+YYKpMbQdnOIEK9D+l92CVe1zGUGSreNyrKC9De7M3S15wpm9Tr8jNfV4KjnxPtUug=="}'
[Relay 1] [Relay] [DEBUG] Data after JSON parse: type=<class 'dict'>, keys=['session_key', 'payload']
[Relay 1] [Relay] Received session_key (base64): LLAVWpEcdNL9YiV91Sbn8rTPDESA+MazTvwxDo/g08225pLPF6OeFZX0JTv7P8eEWaHRrnrNfVHAo+OQW3S6LSy/lSctL3R1S8xclcMJdJ+vN0hwMgL29oiUlNZCdvP9zIhhGHLPAUXCPZq1Mh/Z8Sf7id2QrE3MshVHkbC0nrRNij8r1R/JOLmO9CqXPxWTRzyDP+tlR/AkEKSbeuwnHEUdKS+nIvjbZwsjaJOGbNQEce1TT5QDUIZ1w9ehgDzOoBEVM6Mc0IawzC/FCClERBA8L7WeoMjLTtm8QIEAgo1wi7G4rDUS/yFNGq+XrP3lnam3mcfFCim8huFH7N0plA==
[Relay 1] [Relay] Decoded session_key_enc (hex): 2cb0155a911c74d2fd62257dd526e7f2b4cf0c4480f8c6b34efc310e8fe0d3cdb6e692cf17a39e1595f4253bfb3fc78459a1d1ae7acd7d51c0a3e3905b74ba2d2cbf95272d2f74754bcc5c95c309749faf3748703202f6f6889494d64276f3fdcc88611872cf0145c23d9ab5321fd9f127fb89dd90ac4dccb2154791b0b49eb44d8a3f2bd51fc938b98ef42a973f1593473c833feb6547f02410a49b7aec271c451d292fa722f8db670b236893866cd40471ed534f9403508675c3d7a1803ccea0111533a31cd086b0cc2fc508294444103c2fb59ea0c8cb4ed9bc408100828d708bb1b8ac3512ff214d1aaf97acfde59da9b799c7c50a29bc86e147ecdd2994
[Relay 1] [Relay] Decrypting session key with fingerprint: 74019246e4745ea09badde25326501d85571359b8b49ebb8349bb13a86da1d92
[Relay 1] [Relay] Decrypted session_key (hex): 1c17f7915003f9d6625a12c226763a39a4ad4063cd1a3b5b874a0aed175a9bc8
[Relay 1] [Relay] [DEBUG] About to AES-decrypt payload (passing base64 string directly)
[Relay 1] [Relay] [DEBUG] Payload base64-decoded: type=<class 'bytes'>, len=493, preview=b'\xdf\xc1h\x96\xb1\xb9\xd0\xd7W\xe1\x87\xb7\xe5\xbe\xf8Ij\xa4\x9972\xc1o\xf8Ka\xbb.\xcd\xc1L\x8fn#\xa0\x1a&s]f\x92\xa4G\r\xd05~\x16v\xa4\x135\xdb\xb6:\xdf\xdc\x88T-'
[Relay 1] [Relay] [DEBUG] AES-decrypted payload: type=<class 'bytes'>, len=477, preview=b'{"next_ip": "127.0.0.1", "next_port": 9100, "session_key": "'
[Relay 1] [Relay] [DEBUG] AES-decrypted payload (hex): 7b226e6578745f6970223a20223132372e302e302e31222c20226e6578745f706f7274223a20393130302c202273657373696f6e5f6b6579223a2022
[Relay 1] [Relay] [DEBUG] AES-decrypted payload as UTF-8: '{"next_ip": "127.0.0.1", "next_port": 9100, "session_key": "xVW33EdAgPOaZ9xnFVaEFOgjoLb/s4cwAgSfU7JSKWY64n/gwc88EtTDYDD/'
[Relay 1] [Relay] [DEBUG] Inner payload is JSON, forwarding to next relay.
[Relay 1] [Relay] [DEBUG] Forwarding to next relay 127.0.0.1:9100
[Relay 1] [Relay] [DEBUG] Received response from next relay: type=<class 'bytes'>, len=460, preview=b'{"result": "OK", "echo": {"session_key": "xVW33EdAgPOaZ9xnFV'
[Relay 1] [Relay] [RETURN] AES-encrypted response (hex): b7caf0732d5634c7a8202169ad695fa1acc6529b0e1a2de35c101c9ed5771f5edf89cdb5cbe338f18586fa2d1f384b88531a72f247eb5b30b2973930
[Relay 1] [Relay] [RETURN] Base64-encoded AES-encrypted response: type=<class 'bytes'>, len=636, preview=b't8rwcy1WNMeoICFprWlfoazGUpsOGi3jXBAcntV3H17fic21y+M48YWG+i0f'
[Relay 1] [Relay] [handle_message END] addr=('10.250.120.196', 61616), thread=6162165760
[Relay 1] [Relay] Deregistering from CDS and shutting down...
[Relay 1] [Relay] ERROR during deregistration: [Errno 54] Connection reset by peer
[Relay] ---- Relay process started ----
Usage: python relay.py <relay_id> <listen_port>
