[Relay] ---- Relay process started ----
[Relay 2] [Relay] Loaded persistent RSA keypair from relay2_key.pem
[Relay 2] [Relay] Public key fingerprint: 30c6ba45aeff3f8543ce1edb4f46f412e6bcb0300acbf2a008df3bf75d6a137d
[Relay 2] [Relay] [KEY] Public key fingerprint: 30c6ba45aeff3f8543ce1edb4f46f412e6bcb0300acbf2a008df3bf75d6a137d
[Relay 2] Relay 2 starting on 10.250.120.196:9102 (RELAY PORT 9102)
[Relay 2] Registering with CDS at 127.0.0.1:9000
[Relay 2] [Relay] Registered with CDS: {'ip': '10.250.120.196', 'port': 9102, 'public_key': '-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA58J3pSrOQd4hYnuzQQ7q\nWrjjo+3BJp+ik23brR2yl0kjtfH+wjD9LYWHS7dBxsDRzSozJ/7EWKKNCaTsgvaF\nN6vpyBPqDM/uQfOWfirteL50RgDZw95Vml4Fuay7bTBEb1J8ydvFqawo8rnLE2I3\nU4BjBT+CD38bY3je8wrrCX9fo1uYaLDlfteGshadZ2gnTxrAzkZZ/CTFdyb8JrmN\nIuxjBVjwSA/uIv+KHWQhXRA5jJPXcNV88LYXyEzpid1Cr9gnrqA88K0HSleiwZjU\nJF3LhBvS2Ga2HHfFsk5D/yz/pTHwDvRA98VMT/90wahwmSJsck4XWDFhmNhy3oDR\nBQIDAQAB\n-----END PUBLIC KEY-----\n'}
[Relay 2] [Relay] Listening for incoming messages on port 9102 (RELAY PORT 9102)
[Relay 2] [Relay] [handle_message ENTERED] addr=('10.250.120.196', 61610), thread=6191050752, relay_port=9102
[Relay 2] [Relay] [DEBUG] Raw data received: b'{"next_ip": "10.250.120.196", "next_port": 9102, "session_key": "xGTDDtjcfWNc7FCtxNGtSjS9cgR/rsdU2zeRGuh7k6/b6wWO3+2lCOlyXJgzgC7d3eX+tn6ikgTVgf5soU+Ozb6G/1DvgvNqnkHaHxLB1trehbw+Y5ZeYYtLNC6INR0yBNkFIaFjOR5oAhATLCf0eOyX2yjKMRrHiTp+C1/TOHlFqblFRUYh+Mgs6dx6T44/G05qyMTZBszhjw5eAVHxFWXWqGw1rEXwZJhwhDJN+tD7BOLQlT46cvIc6nfz/Eg3amV0RQrxQoS9CJhTWoth0Eb4rkrGSB2OIyFU8ZAqI3NMhhoJ+1xjnfVQWtOL5+ISzMwWpN1OtZaMoXNH1vAA3A==", "payload": "Www/GHNVmBdU/BurAdHRD38WxhAj7jzg45rXAWoht+jJwtsKJ1102DXU8MHe5qB0C5rChkymlowmS2TUaLRLIO8AWIfDTFdb41xLbYDuTSDtMDLJMsHRaQm5xlfqEz3hIS/jBoS7rtgn+HSGOMLAlr7JcElh/PFSfvN4jWuGj398yvq0u/EIFGlfWRtBGE2FB0FOZjYUnuZdUZoovp1YPAcaJIvZcVSWB1VkqUZ8H2qg4RhP4rA8BX3IcPcDDXs4G6vOC7b+tj+vBLg+1kAtuQ2WiO2AbymelYF918g7dQgNEYu6W11XTQ5de2acYDNiHuylAKWhepMVQpdUMWQgzBgR2EmacGG2d40XxDzZELtTHceUpEH9NRpM7QymIVtvapCIyeCNjTefZN1UaEyKhkwWq/Lsa9km8a79sUxsM2R1bfoaEWf+F8b1cuApxmpAkaDIDPTUXFBXqoWF5PR1X3Juz6uwBI3HtcCQGLWIj1Uc0Rd7hh5j8EI7v2z16lxGLaniwcmMJbK+V9z5kIeGjlxzNSSP0O+rV/QxaKjnapELkqAMAMY/WUpYyNs7EkpppsdXnw5htMLGW6izaubwfa5PqKnXor/tN/8PIGktsQ0gtgBsTQeZgHiu5z1PGAFHkikniIvuw1R9etxl2pw9lrEPO2rLcGIx6E3/608nivgjHa1GzI+70Gd1oi5gCoiU/tnJpkxziJlw6p8dwQ+sLXgwZeFQDlLfmF2kJJQmxpW36XDHDlAI1ZG1/xUIpstSKWneDSbzB1r4jpSdlJF/aj4ybYHEVDWC41+e3+7YU4HY6I9KMxnJuJsPMhUOGEHpXt1p+DjaLkpd17H4yjmjKJRxRwpOfNuQ65ywzrZm1lfGAIRyvAZ3sLSE3XLgakNFCvKsCsKZQwVDy364VJwUf8UAWhtf5Kppq+UKaYOhuIpC5PmX5eqCMssVz9DzyiIoMY3sjbJ0Exi9C0f7wMuEeAHVuOw7qot5Q8mdgF3LOGqiwvstpSEyX6+4gRVa/6FbIcDYfntUm2xSG1gC7NTeR/S6wG+vHPze9Buj5V+RPSl5NZ0VLfPhaD3E+E7arlOAh6IE0fx5HlnK9tK8qa+7+jTHqltm8/7j2DtRYeBADHwVjZl0yM6uq179xFtICAKVkgsHNa2t4e6J+US9QbbG2ohZkT9zR5iXCVL3+Pz43/8FFo+rDzkBym3xBmeE2kmPhp/3L9UzuRX994maCq/TJ8K++b5hb78b/u5xEMV7zUmaT4pj1JA8aEPTyUncj16PtV1pos+/LQ0ufbngIh2gQ/jEMQ6emWYSDbCVQcAROo/ZZ3ML7J6red6sk27UR069rf0x7XfqyneKIRGJegGH0EH6hORvev8w1PZ2J0h4+YvXn3sg0cNOAuaT/4HI0ujyb9xPObcen5Ow0DnFC5bV8yY7iu5LIRWYKxk2hjZTQqnMcdUTpCNAUU30DmTDQw=="}'
[Relay 2] [Relay] [DEBUG] Data after JSON parse: type=<class 'dict'>, keys=['next_ip', 'next_port', 'session_key', 'payload']
[Relay 2] [Relay] Received session_key (base64): xGTDDtjcfWNc7FCtxNGtSjS9cgR/rsdU2zeRGuh7k6/b6wWO3+2lCOlyXJgzgC7d3eX+tn6ikgTVgf5soU+Ozb6G/1DvgvNqnkHaHxLB1trehbw+Y5ZeYYtLNC6INR0yBNkFIaFjOR5oAhATLCf0eOyX2yjKMRrHiTp+C1/TOHlFqblFRUYh+Mgs6dx6T44/G05qyMTZBszhjw5eAVHxFWXWqGw1rEXwZJhwhDJN+tD7BOLQlT46cvIc6nfz/Eg3amV0RQrxQoS9CJhTWoth0Eb4rkrGSB2OIyFU8ZAqI3NMhhoJ+1xjnfVQWtOL5+ISzMwWpN1OtZaMoXNH1vAA3A==
[Relay 2] [Relay] Decoded session_key_enc (hex): c464c30ed8dc7d635cec50adc4d1ad4a34bd72047faec754db37911ae87b93afdbeb058edfeda508e9725c9833802edddde5feb67ea29204d581fe6ca14f8ecdbe86ff50ef82f36a9e41da1f12c1d6dade85bc3e63965e618b4b342e88351d3204d90521a163391e680210132c27f478ec97db28ca311ac7893a7e0b5fd3387945a9b945454621f8c82ce9dc7a4f8e3f1b4e6ac8c4d906cce18f0e5e0151f11565d6a86c35ac45f064987084324dfad0fb04e2d0953e3a72f21cea77f3fc48376a6574450af14284bd0898535a8b61d046f8ae4ac6481d8e232154f1902a23734c861a09fb5c639df5505ad38be7e212cccc16a4dd4eb5968ca17347d6f000dc
[Relay 2] [Relay] Decrypting session key with fingerprint: 30c6ba45aeff3f8543ce1edb4f46f412e6bcb0300acbf2a008df3bf75d6a137d
[Relay 2] [Relay] Decrypted session_key (hex): 304e20f4ad81e8fdf6287f0b9c74755e843d04576c82fdfc49c94892749e5660
[Relay 2] [Relay] [DEBUG] About to AES-decrypt payload (passing base64 string directly)
[Relay 2] [Relay] [DEBUG] Payload base64-decoded: type=<class 'bytes'>, len=1102, preview=b"[\x0c?\x18sU\x98\x17T\xfc\x1b\xab\x01\xd1\xd1\x0f\x7f\x16\xc6\x10#\xee<\xe0\xe3\x9a\xd7\x01j!\xb7\xe8\xc9\xc2\xdb\n']t\xd85\xd4\xf0\xc1\xde\xe6\xa0t\x0b\x9a\xc2\x86L\xa6\x96\x8c&Kd\xd4"
[Relay 2] [Relay] [DEBUG] AES-decrypted payload: type=<class 'bytes'>, len=1086, preview=b'{"next_ip": "10.250.120.196", "next_port": 9101, "session_ke'
[Relay 2] [Relay] [DEBUG] AES-decrypted payload (hex): 7b226e6578745f6970223a202231302e3235302e3132302e313936222c20226e6578745f706f7274223a20393130312c202273657373696f6e5f6b65
[Relay 2] [Relay] [DEBUG] AES-decrypted payload as UTF-8: '{"next_ip": "10.250.120.196", "next_port": 9101, "session_key": "LLAVWpEcdNL9YiV91Sbn8rTPDESA+MazTvwxDo/g08225pLPF6OeFZX'
[Relay 2] [Relay] [DEBUG] Inner payload is JSON, forwarding to next relay.
[Relay 2] [Relay] [DEBUG] Forwarding to next relay 10.250.120.196:9101
[Relay 2] [Relay] [DEBUG] Received response from next relay: type=<class 'bytes'>, len=636, preview=b't8rwcy1WNMeoICFprWlfoazGUpsOGi3jXBAcntV3H17fic21y+M48YWG+i0f'
[Relay 2] [Relay] [RETURN] AES-encrypted response (hex): de16aeff11574382ec2130b681e174a84e1823292c3907eb234e0dbbc01a9c28dd3c02be984b465d7f2477a76b5f4435b0544e03a9a82e29fcf83ea5
[Relay 2] [Relay] [RETURN] Base64-encoded AES-encrypted response: type=<class 'bytes'>, len=872, preview=b'3hau/xFXQ4LsITC2geF0qE4YIyksOQfrI04Nu8AanCjdPAK+mEtGXX8kd6dr'
[Relay 2] [Relay] [handle_message END] addr=('10.250.120.196', 61610), thread=6191050752
[Relay 2] [Relay] Deregistering from CDS and shutting down...
[Relay 2] [Relay] ERROR during deregistration: [Errno 54] Connection reset by peer
[Relay] ---- Relay process started ----
Usage: python relay.py <relay_id> <listen_port>
